var t=Object.defineProperty,e=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,o,r)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r,__spreadValues=(t,n)=>{for(var a in n||(n={}))o.call(n,a)&&__defNormalProp(t,a,n[a]);if(e)for(var a of e(n))r.call(n,a)&&__defNormalProp(t,a,n[a]);return t};import{computed as n,unref as a,watch as i}from"vue";import{m as s}from"../utils/map-object.mjs";import{u as l}from"./useDomRect.mjs";import{u}from"./useClientOnly.mjs";const c=["top","bottom","left","right"].reduce(((t,e)=>[...t,e,`${e}-start`,`${e}-end`,`${e}-center`]),["auto"]),parsePlacement=t=>{const[e,o]=t.split("-");return{position:e,align:o||"center"}},calculateContentAlignment=(t,e,o,r)=>"start"===t?e:"end"===t?e+o-r:e+(o-r)/2,calculateContentCoords=(t,e,o)=>{const{position:r,align:n}=parsePlacement(t),a=calculateContentAlignment(n,e.left,e.width,o.width),i=calculateContentAlignment(n,e.top,e.height,o.height);switch(r){case"top":return{x:a,y:e.top-o.height};case"left":return{y:i,x:e.left-o.width};case"right":return{y:i,x:e.right};default:return{x:a,y:e.bottom}}},calculateOffsetCoords=(t,e)=>{const{position:o}=parsePlacement(t),{main:r,cross:n}=(t=>Array.isArray(t)?{main:t[0],cross:t[1]}:{main:t,cross:0})(e);switch(o){case"left":return{y:n,x:-r};case"right":return{y:n,x:r};case"top":return{y:-r,x:n};default:return{y:r,x:n}}},calculateContentOverflow=(t,e,o)=>{const r=o.right,n=o.bottom,a=o.left,i=o.top;return{top:Math.max(i-t.y,0),bottom:Math.max(t.y+e.height-n,0),left:Math.max(a-t.x,0),right:Math.max(t.x+e.width-r,0)}},clamp=(t,e,o)=>Math.max(Math.min(e,o),t),usePopover=(t,e,o)=>{const r=u((()=>document)),c=n((()=>{if(!r.value)return;const{root:t}=a(o);return t?r.value.querySelector(t):r.value.body})),{domRect:m}=l(t),{domRect:h}=l(e),p={width:"max-content",position:"absolute"},updateContentCSS=()=>{if(!c.value||!m.value||!h.value)return;let t={x:0,y:0};const{placement:r,keepAnchorWidth:n,offset:i,autoPlacement:l,stickToEdges:u}=a(o);let f=calculateContentCoords(r,m.value,h.value);if(i&&(t=calculateOffsetCoords(r,i),f=s(f,((e,o)=>e+t[o]))),n){const{width:t}=m.value;Object.assign(p,{width:`${t}px`,maxWidth:`${t}px`})}const y=c.value.getBoundingClientRect();if(l){const e=((t,e,o,r)=>{const{position:n,align:a}=parsePlacement(t),i=calculateContentOverflow(e,o,r),s={top:["bottom",a].join("-"),bottom:["top",a].join("-"),right:["left",a].join("-"),left:["right",a].join("-")};return i[n]?s[n]:t})(r,f,h.value,y);e!==r&&(f=calculateContentCoords(e,m.value,h.value),i&&(t=calculateOffsetCoords(e,i),f=s(f,((e,o)=>e+t[o]))))}u&&(f=((t,e,o,r,n)=>{const{top:a,bottom:i,left:s,right:l}=calculateContentOverflow(t,o,n),u=t.x-l+s,c=t.y-i+a,{x:m,y:h}=e;return{x:clamp(r.left+m-o.width,u,r.right+m),y:clamp(r.top+h-o.height,c,r.bottom+h)}})(f,t,h.value,m.value,y)),e.value&&Object.assign(e.value.style,__spreadValues(__spreadValues({},p),(({x:t,y:e})=>({left:`${t}px`,top:`${e}px`}))(f)))};return i(m,updateContentCSS),i(h,updateContentCSS),i(o,updateContentCSS,{deep:!0}),{anchorDomRect:m,contentDomRect:h}};export{c as p,usePopover as u};
//# sourceMappingURL=usePopover.mjs.map
