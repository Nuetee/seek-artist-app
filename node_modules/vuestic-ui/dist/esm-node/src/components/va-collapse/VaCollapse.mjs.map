{"version":3,"file":"VaCollapse.mjs","sources":["../../../../../src/components/va-collapse/VaCollapse.vue"],"sourcesContent":["<template>\n  <div class=\"va-collapse\" :class=\"computedClasses\">\n    <div\n      class=\"va-collapse__header-wrapper\"\n      v-on=\"keyboardFocusListeners\"\n      @focus=\"$emit('focus')\"\n      @click=\"toggle\"\n      @keydown.enter=\"toggle\"\n      @keydown.space=\"toggle\"\n    >\n      <slot\n        name=\"header\"\n        v-bind=\"{\n          value: computedModelValue,\n          hasKeyboardFocus: hasKeyboardFocus,\n          bind: headerAttributes,\n          attributes: headerAttributes,\n        }\"\n      >\n        <div\n          v-bind=\"headerAttributes\"\n          class=\"va-collapse__header\"\n          :style=\"headerStyle\"\n        >\n          <va-icon\n            v-if=\"icon\"\n            class=\"va-collapse__header__icon\"\n            :name=\"icon\"\n            :color=\"textColorComputed\"\n          />\n          <div class=\"va-collapse__header__text\">\n            {{ header }}\n          </div>\n          <va-icon\n            class=\"va-collapse__header__icon\"\n            :name=\"computedModelValue ? 'expand_less' : 'expand_more'\"\n            :color=\"textColorComputed\"\n          />\n        </div>\n      </slot>\n    </div>\n    <div\n      ref=\"body\"\n      class=\"va-collapse__body\"\n      role=\"region\"\n      :style=\"contentStyle\"\n      :id=\"panelIdComputed\"\n      :aria-labelledby=\"headerIdComputed\"\n    >\n      <slot />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, shallowRef } from 'vue'\nimport pick from 'lodash/pick.js'\n\nimport { useKeyboardOnlyFocus, useColors, useSyncProp, useTextColor, useBem } from '../../composables'\nimport { useAccordionItem } from '../va-accordion/hooks/useAccordion'\n\nimport { generateUniqueId } from '../../services/utils'\n\nimport { VaIcon } from '../va-icon'\n\nexport default defineComponent({\n  name: 'VaCollapse',\n  components: {\n    VaIcon,\n  },\n  props: {\n    modelValue: { type: Boolean, default: undefined },\n    disabled: { type: Boolean, default: false },\n    header: { type: String, default: '' },\n    icon: { type: String, default: '' },\n    solid: { type: Boolean, default: false },\n    color: { type: String, default: 'background' },\n    textColor: { type: String, default: '' },\n    colorAll: { type: Boolean, default: false },\n  },\n  emits: ['focus', 'update:modelValue'],\n\n  setup (props, { emit, slots }) {\n    const body = shallowRef<HTMLElement>()\n\n    const [computedModelValue] = useSyncProp('modelValue', props, emit, false)\n\n    const { getColor, getHoverColor } = useColors()\n    const { accordionProps, toggle } = useAccordionItem(computedModelValue)\n\n    const { textColorComputed } = useTextColor()\n\n    const getTextNodeHeight = (textNode: Node) => {\n      const range = document.createRange()\n      range.selectNodeContents(textNode)\n      const rect = range.getBoundingClientRect()\n\n      return rect.bottom - rect.top\n    }\n\n    const getNodeHeight = (node: Node) => {\n      // https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeName\n      if (node.nodeName === '#text') { return getTextNodeHeight(node) }\n      if (node.nodeName === '#comment') { return 0 }\n\n      return (node as Element).clientHeight\n    }\n\n    const height = computed(() => {\n      if (!computedModelValue.value || !body.value) { return 0 }\n\n      const nodes = Array.from(body.value.childNodes) as HTMLElement[]\n      return nodes.reduce((result: number, node: HTMLElement) => result + getNodeHeight(node), 0)\n    })\n\n    const { hasKeyboardFocus, keyboardFocusListeners } = useKeyboardOnlyFocus()\n\n    const getTransition = () => {\n      const duration = height.value / 1000 * 0.2\n      return `${duration > 0.2 ? duration : 0.2}s`\n    }\n\n    const getBackground = () => {\n      return props.color && props.colorAll\n        ? getHoverColor(getColor(props.color))\n        : ''\n    }\n\n    const uniqueId = computed(generateUniqueId)\n    const headerIdComputed = computed(() => `header-${uniqueId.value}`)\n    const panelIdComputed = computed(() => `panel-${uniqueId.value}`)\n    const tabIndexComputed = computed(() => props.disabled ? -1 : 0)\n\n    const headerAttributes = computed(() => ({\n      id: headerIdComputed.value,\n      tabindex: tabIndexComputed.value,\n      'aria-controls': panelIdComputed.value,\n      'aria-expanded': computedModelValue.value,\n      'aria-disabled': props.disabled,\n      role: 'button',\n    }))\n\n    const computedClasses = useBem('va-collapse', () => ({\n      ...pick(props, ['disabled', 'solid']),\n      expanded: computedModelValue.value,\n      active: props.solid && computedModelValue.value,\n      popout: !!(accordionProps.value.popout && computedModelValue.value),\n      inset: !!(accordionProps.value.inset && computedModelValue.value),\n    }))\n\n    return {\n      body,\n      height,\n\n      toggle,\n      computedModelValue,\n\n      hasKeyboardFocus,\n      keyboardFocusListeners,\n\n      textColorComputed,\n\n      headerIdComputed,\n      headerAttributes,\n      panelIdComputed,\n      tabIndexComputed,\n\n      computedClasses,\n\n      headerStyle: computed(() => ({\n        paddingLeft: props.icon && 0,\n        color: textColorComputed.value,\n        backgroundColor: props.color ? getColor(props.color) : '',\n      })),\n\n      contentStyle: computed(() => {\n        const hasContent = computedModelValue.value && !!slots.default?.()[0]\n\n        return {\n          visibility: hasContent ? 'visible' as const : 'hidden' as const,\n          height: `${height.value}px`,\n          transitionDuration: getTransition(),\n          background: hasContent ? getBackground() : '',\n        }\n      }),\n    }\n  },\n})\n</script>\n\n<style lang=\"scss\">\n@import \"../../styles/resources\";\n@import \"variables\";\n\n.va-collapse {\n  transition: var(--va-collapse-transition, var(--va-swing-transition));\n  font-family: var(--va-font-family);\n\n  &__body {\n    transition: var(--va-collapse-body-transition);\n    overflow: var(--va-collapse-body-overflow);\n  }\n\n  &__header {\n    display: var(--va-collapse-header-content-display);\n    justify-content: var(--va-collapse-header-content-justify-content);\n    cursor: var(--va-collapse-header-content-cursor);\n    background-color: var(--va-collapse-header-content-background-color);\n    box-shadow: var(--va-collapse-header-content-box-shadow, var(--va-block-box-shadow));\n    border-radius: var(--va-collapse-header-content-border-radius, var(--va-block-border-radius));\n    align-items: var(--va-collapse-header-content-align-items);\n    padding-top: var(--va-collapse-header-content-padding-top);\n    padding-bottom: var(--va-collapse-header-content-padding-bottom);\n    padding-left: var(--va-collapse-header-content-padding-left);\n\n    &__text {\n      width: var(--va-collapse-header-content-text-width);\n    }\n\n    &__icon {\n      @include flex-center();\n\n      min-width: var(--va-collapse-header-content-icon-min-width);\n      margin-left: var(--va-collapse-header-content-icon-margin-left);\n      margin-right: var(--va-collapse-header-content-icon-margin-right);\n      color: var(--va-collapse-header-content-icon-color);\n    }\n\n    &:focus {\n      @include focus-outline(var(--va-collapse-header-content-border-radius));\n    }\n  }\n\n  &--solid {\n    box-shadow: var(--va-collapse-solid-box-shadow);\n    border-radius: var(--va-collapse-solid-border-radius);\n\n    .va-collapse {\n      &__header {\n        border-radius: var(--va-collapse-solid-header-content-border-radius, var(--va-block-border-radius));\n        transition: var(--va-collapse-solid-header-content-transition);\n        box-shadow: var(--va-collapse-solid-header-content-box-shadow, var(--va-block-box-shadow));\n        background-color: var(--va-collapse-solid-header-content-background-color);\n      }\n\n      &__body {\n        border-radius: var(--va-collapse-solid-body-border-radius);\n        margin-top: var(--va-collapse-solid-body-margin-top);\n      }\n    }\n  }\n\n  &--popout {\n    margin: var(--va-collapse-popout-margin);\n  }\n\n  &--inset {\n    margin: var(--va-collapse-inset-margin);\n  }\n\n  &--disabled {\n    @include va-disabled();\n  }\n}\n</style>\n"],"names":["_sfc_main","defineComponent","name","components","VaIcon","props","modelValue","type","Boolean","default","disabled","header","String","icon","solid","color","textColor","colorAll","emits","setup","emit","slots","body","shallowRef","computedModelValue","useSyncProp","getColor","getHoverColor","useColors","accordionProps","toggle","useAccordionItem","textColorComputed","useTextColor","getNodeHeight","node","nodeName","textNode","range","document","createRange","selectNodeContents","rect","getBoundingClientRect","bottom","top","getTextNodeHeight","clientHeight","height","computed","value","Array","from","childNodes","reduce","result","hasKeyboardFocus","keyboardFocusListeners","useKeyboardOnlyFocus","getTransition","duration","uniqueId","generateUniqueId","headerIdComputed","panelIdComputed","tabIndexComputed","headerAttributes","id","tabindex","role","computedClasses","useBem","__spreadProps","__spreadValues","pick","expanded","active","popout","inset","headerStyle","paddingLeft","backgroundColor","contentStyle","hasContent","_a","call","visibility","transitionDuration","background","_hoisted_1","class","_createElementBlock","_normalizeClass","_ctx","_createElementVNode","_mergeProps","_toHandlers","onFocus","_cache","$emit","onClick","args","onKeydown","_withKeys","_renderSlot","$slots","_normalizeProps","_guardReactiveProps","bind","attributes","style","_createBlock","_component_va_icon","key","_createCommentVNode","_toDisplayString","_createVNode","ref","_normalizeStyle","_hoisted_2"],"mappings":"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"}