{"version":3,"file":"VaFileUpload.mjs","sources":["../../../../../src/components/va-file-upload/VaFileUpload.vue"],"sourcesContent":["<template>\n  <div\n    class=\"va-file-upload\"\n    :class=\"{ 'va-file-upload--dropzone': dropzone }\"\n    :style=\"computedStyle\"\n  >\n    <slot>\n      <div class=\"va-file-upload__field\">\n        <div\n          v-if=\"dropzone\"\n          class=\"va-file-upload__field__text\"\n        >\n          {{ dropZoneText }}\n        </div>\n        <va-button\n          class=\"va-file-upload__field__button\"\n          :disabled=\"disabled\"\n          :color=\"colorComputed\"\n          :style=\"{ 'pointer-events': dropzoneHighlight ? 'none' : '' }\"\n          @change=\"changeFieldValue\"\n          @click=\"callFileDialogue\"\n        >\n          {{ uploadButtonText }}\n        </va-button>\n      </div>\n    </slot>\n\n    <input\n      ref=\"fileInputRef\"\n      type=\"file\"\n      class=\"va-file-upload__field__input\"\n      :tabindex=\"-1\"\n      aria-hidden=\"true\"\n      :accept=\"fileTypes\"\n      :multiple=\"type !== 'single'\"\n      :disabled=\"disabled\"\n      @change=\"changeFieldValue\"\n      @dragenter=\"dropzoneHighlight = true\"\n      @dragleave=\"dropzoneHighlight = false\"\n    >\n    <va-file-upload-list\n      v-if=\"files.length && !$props.hideFileList\"\n      :type=\"type\"\n      :files=\"files\"\n      :color=\"colorComputed\"\n      :undo=\"undo\"\n      :undoDuration=\"undoDuration\"\n      @remove=\"removeFile\"\n      @removeSingle=\"removeSingleFile\"\n    />\n    <va-modal\n      v-model=\"modal\"\n      hide-default-actions\n      title=\"File validation\"\n      message=\"File type is incorrect!\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, onMounted, ref, toRef, PropType, shallowRef, provide } from 'vue'\n\nimport { useColors } from '../../composables'\n\nimport type { VaFile } from './types'\nimport { VaFileUploadKey } from './types'\n\nimport { VaButton, VaModal } from '../index'\nimport { VaFileUploadList } from './VaFileUploadList'\n\nexport default defineComponent({\n  name: 'VaFileUpload',\n\n  components: {\n    VaModal,\n    VaButton,\n    VaFileUploadList,\n  },\n\n  props: {\n    fileTypes: { type: String, default: '' },\n    dropzone: { type: Boolean, default: false },\n    hideFileList: { type: Boolean, default: false },\n    color: { type: String, default: 'primary' },\n    disabled: { type: Boolean, default: false },\n    undo: { type: Boolean, default: false },\n    undoDuration: { type: Number, default: 3000 },\n    undoButtonText: { type: String, default: 'Undo' },\n    dropZoneText: { type: String, default: 'Drag’n’drop files or' },\n    uploadButtonText: { type: String, default: 'Upload file' },\n    deletedFileMessage: { type: String, default: 'File was successfully deleted' },\n    modelValue: {\n      type: [Object, Array] as PropType<VaFile | VaFile[]>,\n      default: () => [],\n    },\n    type: {\n      type: String as PropType<'list' | 'gallery' | 'single'>,\n      default: 'list',\n      validator: (value: string) => ['list', 'gallery', 'single'].includes(value),\n    },\n  },\n\n  emits: ['update:modelValue', 'file-removed', 'file-added'],\n\n  setup (props, { emit }) {\n    const fileInputRef = shallowRef<HTMLInputElement>()\n\n    const modal = ref(false)\n    const dropzoneHighlight = ref(false)\n\n    const { getColor, shiftHSLAColor } = useColors()\n    const colorComputed = computed(() => getColor(props.color))\n\n    const computedStyle = computed(() => ({\n      backgroundColor: props.dropzone\n        ? shiftHSLAColor(colorComputed.value, { a: dropzoneHighlight.value ? -0.82 : -0.92 })\n        : 'transparent',\n    }))\n\n    const files = computed<VaFile[]>({\n      get () { return Array.isArray(props.modelValue) ? props.modelValue : [props.modelValue] },\n      set (files) {\n        if (props.type === 'single') {\n          emit('update:modelValue', files[0])\n        } else {\n          emit('update:modelValue', files)\n        }\n      },\n    })\n\n    const validateFiles = (files: VaFile[]) => files.filter((file) => {\n      const fileName = file.name || file.url\n      if (!fileName) { return false }\n      if (file.url) { return true }\n\n      const MIMETypes = ['audio/*', 'video/*', 'image/*']\n      const isContainedMIMEType = MIMETypes.find((t) => props.fileTypes.includes(t))\n\n      if (isContainedMIMEType) {\n        // Do not validate MIMEType because there is too much to validate.\n        return true\n      }\n\n      const extension = fileName.substring(fileName.lastIndexOf('.') + 1).toLowerCase()\n\n      const isCorrectExt = props.fileTypes.includes(extension)\n      if (!isCorrectExt) { modal.value = true }\n\n      return isCorrectExt\n    })\n\n    const uploadFile = (e: Event | DragEvent) => {\n      const f = (e.target as HTMLInputElement)?.files || (e as DragEvent).dataTransfer?.files\n\n      if (!f) { return }\n\n      const validatedFiles = props.fileTypes ? validateFiles(Array.from(f)) : f\n\n      files.value = props.type === 'single' ? (validatedFiles as VaFile[]) : [...files.value, ...validatedFiles]\n\n      emit('file-added', validatedFiles)\n    }\n\n    const changeFieldValue = (e: Event | DragEvent) => {\n      uploadFile(e)\n\n      if (fileInputRef.value) {\n        fileInputRef.value.value = ''\n      }\n    }\n\n    const removeFile = (index: number) => {\n      if (index in files.value) {\n        const removedFile = files.value[index]\n        files.value = files.value.filter((item, idx) => idx !== index)\n        emit('file-removed', removedFile)\n      }\n    }\n\n    const removeSingleFile = () => {\n      if (files.value.length > 0) {\n        const removedFile = files.value[0]\n        files.value = []\n        emit('file-removed', removedFile)\n      }\n    }\n\n    const callFileDialogue = () => {\n      if (fileInputRef.value) {\n        fileInputRef.value.click()\n      }\n    }\n\n    onMounted(() => {\n      if (Array.isArray(files.value)) {\n        files.value = validateFiles(files.value)\n      }\n    })\n\n    provide(VaFileUploadKey, {\n      undoDuration: toRef(props, 'undoDuration'),\n      undoButtonText: toRef(props, 'undoButtonText'),\n      deletedFileMessage: toRef(props, 'deletedFileMessage'),\n    })\n\n    return {\n      modal,\n      dropzoneHighlight,\n      fileInputRef,\n      colorComputed,\n      computedStyle,\n      uploadFile,\n      changeFieldValue,\n      files,\n      removeFile,\n      removeSingleFile,\n      callFileDialogue,\n    }\n  },\n})\n</script>\n\n<style lang='scss'>\n@import \"../../styles/resources\";\n@import \"variables\";\n\n.va-file-upload {\n  position: var(--va-file-upload-position);\n  font-family: var(--va-font-family);\n  margin: var(--va-file-upload-margin);\n\n  .va-file-upload-list {\n    margin-top: var(--va-file-upload-list-margin-top);\n  }\n\n  &--dropzone {\n    background-color: var(--va-file-upload-dropzone-background-color);\n    overflow: var(--va-file-upload-dropzone-overflow);\n    border-radius: var(--va-file-upload-dropzone-border-radius);\n    cursor: var(--va-file-upload-dropzone-cursor);\n\n    .va-file-upload__field {\n      justify-content: center;\n      display: flex;\n      align-items: center;\n      padding: var(--va-file-upload-dropzone-field-padding);\n      transition: height 0.2s;\n      overflow: visible;\n      flex-wrap: wrap;\n\n      @include media-breakpoint-down(sm) {\n        flex-direction: column;\n        padding: var(--va-file-upload-dropzone-field-padding-sm);\n\n        &__text {\n          padding: var(--va-file-upload-dropzone-text-padding-sm);\n          text-align: center;\n        }\n      }\n    }\n\n    .va-file-upload-list {\n      padding: var(--va-file-upload-dropzone-list-padding);\n      margin-top: 0;\n    }\n  }\n\n  &__field {\n    overflow: var(--va-file-upload-dropzone-field-overflow);\n    display: var(--va-file-upload-dropzone-field-display);\n    align-items: var(--va-file-upload-dropzone-field-align-items);\n    position: var(--va-file-upload-dropzone-field-position);\n\n    &__button {\n      margin: var(--va-file-upload-dropzone-field-button-margin);\n      z-index: var(--va-file-upload-dropzone-field-button-z-index);\n    }\n\n    &__text {\n      padding-right: var(--va-file-upload-dropzone-field-text-pr);\n    }\n\n    &__input {\n      position: absolute;\n      top: 0;\n      right: 0;\n      height: 100%;\n      width: 100%;\n      color: transparent;\n      opacity: 0;\n      cursor: pointer;\n\n      &::-webkit-file-upload-button {\n        cursor: pointer;\n      }\n    }\n  }\n}\n</style>\n"],"names":["_sfc_main","defineComponent","name","components","VaModal","VaButton","VaFileUploadList","props","fileTypes","type","String","default","dropzone","Boolean","hideFileList","color","disabled","undo","undoDuration","Number","undoButtonText","dropZoneText","uploadButtonText","deletedFileMessage","modelValue","Object","Array","validator","value","includes","emits","setup","emit","fileInputRef","shallowRef","modal","ref","dropzoneHighlight","getColor","shiftHSLAColor","useColors","colorComputed","computed","computedStyle","backgroundColor","a","files","get","isArray","set","files2","validateFiles","filter","file","fileName","url","find","t","extension","substring","lastIndexOf","toLowerCase","isCorrectExt","uploadFile","e","f","_a","target","_b","dataTransfer","validatedFiles","from","onMounted","provide","VaFileUploadKey","toRef","changeFieldValue","removeFile","index","removedFile","item","idx","removeSingleFile","length","callFileDialogue","click","_hoisted_1","class","_createElementBlock","_normalizeClass","_ctx","style","_normalizeStyle","_renderSlot","_createElementVNode","openBlock","_hoisted_2","_toDisplayString","_createCommentVNode","_createVNode","_component_va_button","onChange","onClick","_createTextVNode","tabindex","accept","multiple","_cache","args","onDragenter","onDragleave","_hoisted_3","$props","_openBlock","_createBlock","_component_va_file_upload_list","key","onRemove","onRemoveSingle","_component_va_modal","$event","title","message"],"mappings":"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"}